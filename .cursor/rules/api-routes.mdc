---
globs: app/api/**/*.ts
---

# API Routes Guidelines

## Structure des routes API
- **M√©thodes HTTP** : Impl√©mentez les m√©thodes appropri√©es (GET, POST, PUT, DELETE)
- **Validation** : Validez toujours les param√®tres d'entr√©e
- **Authentification** : V√©rifiez l'authentification avec `extractTeamrToken`
- **Gestion d'erreurs** : Utilisez les codes d'erreur standardis√©s

## Exemple de structure
```typescript
export async function GET(request: NextRequest) {
  try {
    // 1. V√©rifier l'authentification
    const token = extractTeamrToken(request);
    if (!token) {
      return NextResponse.json({ error: { code: ErrorCode.UNAUTHORIZED } }, { status: 401 });
    }

    // 2. Extraire et valider les param√®tres
    const { searchParams } = new URL(request.url);
    const param = searchParams.get('param');

    // 3. Validation
    if (!param) {
      return NextResponse.json({ error: { code: ErrorCode.INVALID_PARAMETER } }, { status: 400 });
    }

    // 4. Logique m√©tier
    const result = await someService(param, token);

    // 5. Retour de la r√©ponse
    return NextResponse.json(result);
  } catch (error) {
    // 6. Gestion d'erreurs
    console.error('Erreur dans GET /api/endpoint:', error);
    return NextResponse.json({ error: { code: ErrorCode.INTERNAL_SERVER_ERROR } }, { status: 500 });
  }
}
```

## Codes d'erreur
- **UNAUTHORIZED** (401) : Authentification requise
- **INVALID_PARAMETER** (400) : Param√®tres invalides
- **INTERNAL_SERVER_ERROR** (500) : Erreur serveur

## Validation des param√®tres
- **ObjectId MongoDB** : Utilisez `/^[0-9a-fA-F]{24}$/` pour valider les ObjectId
- **Dates** : Utilisez `isNaN(Date.parse(date))` pour valider les dates
- **Arrays** : V√©rifiez `Array.isArray()` et la longueur

## Logging
- **Console.log** : Utilisez des pr√©fixes avec emojis pour identifier les logs
- **Exemple** : `console.log('üì• GET /api/endpoint - Param√®tres:', params)`

## R√©f√©rences
- [app/api/bookings/route.ts](mdc:app/api/bookings/route.ts) : Exemple complet avec GET et POST
- [app/types/errors.ts](mdc:app/types/errors.ts) : Codes d'erreur standardis√©s